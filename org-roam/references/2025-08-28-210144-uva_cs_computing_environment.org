:PROPERTIES:
:ID:       dd8e5d6f-b01b-4a3d-ba1c-832a27e7e243
:END:
#+title: UVA CS Computing Environment
#+date: 2025-08-28

[[id:bc1f11cb-958e-43fa-88a2-904fd94805db][University of Virginia]]

* UVA CS Project Directories
https://www.cs.virginia.edu/computing/doku.php?id=project_directories

Project directory /p/nmg5g

* UVA CS [[id:822ba079-5358-4814-94f5-66a7f741b41a][Slurm]] cluster
:PROPERTIES:
:ID:       b5392aff-d459-450c-b18c-a41152a869b3
:END:

https://www.cs.virginia.edu/computing/doku.php?id=compute_slurm#resource_limits

** Create a project-scoped env
Pick a path under your project dir (example: /p/nmg5g/condaenvs/py312):
#+begin_src bash
# on a login node (portal) or short salloc
module load miniforge
mkdir -p /p/nmg5g/condaenvs

# create the env *by path* so it lives in /p
conda create -y --prefix /p/nmg5g/condaenvs/py312 python=3.12
#+end_src

To use it interactively:
#+begin_src bash
module load miniforge
# make 'conda activate' available in non-interactive shells
source "$(conda info --base)/etc/profile.d/conda.sh"
conda activate /p/nmg5g/condaenvs/py312
python -V
#+end_src

** Keep caches out of /u (optional but recommended)
By default, Condaâ€™s package cache and named envs live in your home. Redirect them to /p with a .condarc:
#+begin_src bash
rhe9cf@portal03:~$ cd
rhe9cf@portal03:~$ pwd
/u/rhe9cf
#+end_src

#+begin_src bash
# create/edit ~/.condarc
cat >> ~/.condarc <<'YAML'
envs_dirs:
  - /p/nmg5g/conda/envs
pkgs_dirs:
  - /p/nmg5g/conda/pkgs
YAML

mkdir -p /p/nmg5g/conda/envs /p/nmg5g/conda/pkgs
#+end_src
Conda reads .condarc to set envs_dirs and pkgs_dirs. You can also use conda config --add envs_dirs ... / --add pkgs_dirs ....

** Use the env in Slurm jobs
create hello.py
#+begin_src python
import sys, multiprocessing as mp
print("Python:", sys.version)
print("CPUs visible:", mp.cpu_count())
#+end_src

create conda_example.slurm
#+begin_src file
#!/bin/bash
#SBATCH -p cpu
#SBATCH --cpus-per-task=4
#SBATCH --mem=8G
#SBATCH -t 01:00:00
#SBATCH -J conda-demo
#SBATCH --output=slurm-%A.out

set -euo pipefail
module --ignore_cache purge
module load miniforge

# make `conda activate` work in batch shells
source "$(conda info --base)/etc/profile.d/conda.sh"
conda activate /p/nmg5g/condaenvs/py312

echo "Python: $(python -V) @ $(which python)"
export OMP_NUM_THREADS=$SLURM_CPUS_PER_TASK

# use heredoc with the *activated* interpreter
srun python hello.py
#+end_src

run:
#+begin_src bash
sbatch conda_example.slurm
#+end_src

#+begin_src bash
squeue -u rhe9cf
#+end_src

* Reference List
1. https://www.cs.virginia.edu/computing/doku.php?id=start
