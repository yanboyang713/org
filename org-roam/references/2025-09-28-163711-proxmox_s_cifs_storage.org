:PROPERTIES:
:ID:       250c2326-0ec0-4063-93ab-3a2b27e8d2ae
:END:
#+title: Proxmox’s CIFS storage
#+date: 2025-09-28

[[id:77bd7428-f1ee-4306-8d5a-62f38134dfc5][Proxmox VE]]

* pvesm scan
Running pvesm scan is very useful before adding CIFS or NFS storage in Proxmox because it automatically detects what shares or exports are actually available on the remote server. This way you avoid guessing and misconfiguring --share or --subdir
#+begin_src console
root@server1:~# pvesm scan cifs samba.cs.virginia.edu --username YOUR_UVA_USERNAME --password YOUR_PASSWORD
b       server
bigtemp pigtemp
#+end_src

* add cifs
#+begin_src bash
  pvesm add cifs uva_proj \
    --server samba.cs.virginia.edu \
    --share p \
    --subdir /nmg5g/pve \
    --username YOUR_UVA_USERNAME \
    --password YOUR_PASSWORD \
    --domain CSDOM \
    --smbversion 3 \
    --content images,iso,rootdir,backup,vztmpl,snippets
#+end_src

Explanation of flags

| Option                           | Description                                                                                    |
|----------------------------------+------------------------------------------------------------------------------------------------|
| `cifs`                           | Storage type (CIFS/SMB share).                                                                 |
| `uva_proj`                        | The **storage ID** in Proxmox — name it whatever you want.                                       |
| `--server samba.cs.virginia.edu` | UVA’s SMB server hostname.                                                                     |
| `--share b`                      | CIFS share to use (get available ones with pvesm scan cifs <address> or the web UI). Required. |
| `--subdir nmg5g`                 | Points directly to `/p/nmg5g` instead of listing all projects.                                 |
| `--username`                     | Your UVA CS computing username.                                                                |
| `--password`                     | Your UVA password (or app password, if required).                                              |
| `--smbversion 3`                 | Forces SMBv3 for better performance and security.                                              |
| `--content iso,vztmpl,backup`    | Allow storage of **ISO files**, **container templates**, and **backups** only.                       |

* remove cifs
On any node in the cluster:
#+begin_src bash
# Replace uva_proj with your storage ID if different
pvesm remove uva_proj
#+end_src

* Reference List
1. https://pve.proxmox.com/wiki/Storage%3A_CIFS
2. https://www.cs.virginia.edu/computing/doku.php?id=project_directories
